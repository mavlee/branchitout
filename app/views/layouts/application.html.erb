<!DOCTYPE html>
<html>
  <head>
    <title><%= setTitleBasedOnPage %></title>
    <link rel="icon" href="/assets/favicon.ico" type="image/ico" />
    <%= stylesheet_link_tag   "application" %>
    <%= csrf_meta_tags %>

    <script type="text/javascript">
      window.BranchItOut = {
        currentUser : <%= raw current_user.to_json %>
      };
    </script>

    <% if !Rails.env.development? %>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-28266693-1']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
    <% end %>
  </head>

  <body>
    <div id="fb-root"></div>
    <script>
      /*window.fbAsyncInit = function() {
        FB.init({
          appId      : 'YOUR_APP_ID', // App ID
          channelUrl : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File
          status     : true, // check login status
          cookie     : true, // enable cookies to allow the server to access the session
          xfbml      : true  // parse XFBML
        });
      };
      // Additional initialization code here

      // Load the SDK Asynchronously
      (function(d){
        var js, id = 'facebook-jssdk'; if (d.getElementById(id)) {return;}
        js = d.createElement('script'); js.id = id; js.async = true;
        js.src = "//connect.facebook.net/en_US/all.js";
        d.getElementsByTagName('head')[0].appendChild(js);
      }(document));
      */
    </script>

    <div id="fb-root"></div>
    <script>
      /*(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=217686564916136";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
      */
    </script>

    <div class="container">
      <%= render 'layouts/topbar' %>
      <section class="round">
        <% flash.each do |key, value| %>
          <div class="flash <%= key %>"><%= value %></div>
        <% end %>
      </section>

      <%= yield %>

      <br/>
      <br/>
      <br/>
      <%= debug(params) if Rails.env.development? %>
    </div>
  </body>
</html>
